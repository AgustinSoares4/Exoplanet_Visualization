<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exoplanet Discoveries Timeline</title>
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <style>
    /* ===== ESTILOS GENERALES ===== */
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    /* ===== FONDO ESPACIAL ===== */
    #space-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, #0a0e23 0%, #000000 100%);
      z-index: -10;
      overflow: hidden;
    }

    .star {
      position: absolute;
      background-color: #fff;
      border-radius: 50%;
      opacity: 0.8;
      animation: twinkle 4s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* ===== GRÁFICA TIMELINE ===== */
    #timeline {
      width: 100%;
      height: 600px;
      margin: 0 auto;
      border: 2px solid #333;
      border-radius: 10px;
      box-shadow: 0 0 25px rgba(100, 150, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    #timeline .scatterlayer .trace .points path {
      transition: transform 0.3s ease-out, opacity 0.2s ease;
      cursor: pointer;
    }

    #timeline .scatterlayer .trace .points path:hover {
      transform: scale(1.3);
    }

    @keyframes fadeInScale {
      0% { opacity: 0; transform: scale(0.2); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* ===== BOTONES DE NAVEGACIÓN ===== */
    .button-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 30px;
    }

    .arrow-button {
      background-color: rgba(68, 68, 68, 0.7);
      color: #fff;
      border: 1px solid #777;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5), 0 0 15px rgba(100, 150, 255, 0.3);
      transition: all 0.3s ease;
    }

    .arrow-button:hover {
      background-color: rgba(100, 150, 255, 0.4);
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(100, 150, 255, 0.7);
    }

    .arrow-button:active {
      transform: scale(0.95);
    }

    /* ===== TARJETA DEL PLANETA ===== */
    #planet-card {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: 350px;
      height: auto;
      max-height: 90vh;
      background: linear-gradient(145deg, rgba(20, 40, 80, 0.95) 0%, rgba(10, 20, 40, 0.98) 100%);
      border-radius: 15px;
      border: 2px solid rgba(100, 150, 255, 0.6);
      box-shadow: 0 0 40px rgba(100, 150, 255, 0.5), inset 0 0 30px rgba(100, 150, 255, 0.2);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      z-index: 1000;
      opacity: 0;
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275),
                  opacity 0.5s ease-in-out;
      overflow-y: auto;
      pointer-events: none;
    }

    #planet-card.visible {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      pointer-events: auto;
    }

    .planet-name {
      font-size: 1.8em;
      color: #FFD700;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .planet-image-container {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      overflow: hidden;
      margin: 10px 0;
      border: 3px solid rgba(100, 150, 255, 0.6);
      box-shadow: 0 0 20px rgba(100, 150, 255, 0.6);
      background: radial-gradient(circle at 65% 15%, rgba(255, 255, 255, 0.1) 1px, transparent 3%),
                  radial-gradient(circle at 30% 40%, rgba(255, 255, 255, 0.2) 1px, transparent 4%),
                  radial-gradient(circle at 70% 90%, rgba(255, 255, 255, 0.1) 1px, transparent 2%);
      position: relative;
    }

    .card-shine {
      position: absolute;
      top: 0;
      left: -100%;
      width: 80%;
      height: 100%;
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.1) 25%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0.1) 75%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: skewX(-15deg);
      animation: card-shine-animation 3s ease-in-out infinite;
    }

    @keyframes card-shine-animation {
      0% { left: -100%; }
      20% { left: 100%; }
      100% { left: 100%; }
    }

    /* ===== PESTAÑAS DE LA TARJETA ===== */
    .card-tabs {
      display: flex;
      justify-content: space-around;
      margin: 10px 0;
      width: 100%;
    }

    .tab-button {
      background-color: rgba(30, 60, 100, 0.6);
      color: #adf;
      border: 1px solid rgba(100, 150, 255, 0.4);
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-grow: 1;
      margin: 0 5px;
      font-size: 0.9em;
    }

    .tab-button:hover {
      background-color: rgba(40, 80, 120, 0.7);
    }

    .tab-button.active {
      background-color: rgba(60, 100, 180, 0.7);
      border-color: rgba(100, 150, 255, 0.8);
      box-shadow: 0 0 10px rgba(100, 150, 255, 0.4);
    }

    .tab-content {
      width: 100%;
      transition: all 0.3s ease;
    }

    .tab-content.hidden {
      display: none;
    }

    /* ===== ESTADÍSTICAS DEL PLANETA ===== */
    .planet-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      width: 100%;
    }

    .stat {
      background-color: rgba(30, 60, 100, 0.6);
      border-radius: 8px;
      padding: 10px 5px;
      border: 1px solid rgba(100, 150, 255, 0.4);
      transition: all 0.3s ease;
    }

    .stat:hover {
      background-color: rgba(40, 80, 120, 0.7);
      transform: translateY(-3px);
    }

    .stat-name {
      color: #adf;
      font-size: 0.85em;
      margin-bottom: 5px;
      display: block;
    }

    .stat-value {
      font-size: 1.1em;
      font-weight: bold;
    }

    .planet-type {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: rgba(255, 215, 0, 0.8);
      color: #000;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 0.7em;
      font-weight: bold;
    }

    /* ===== HEADER Y OVERLAY ===== */
    #header {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.2em;
      color: #adf;
      text-shadow: 0 0 10px rgba(100, 150, 255, 0.8);
    }

    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      color: white;
    }

    .close-button:hover {
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 900;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    #overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* ===== CONTENEDOR PRINCIPAL ===== */
    .container {
      display: flex;
      position: relative;
    }

    .main-content {
      flex-grow: 1;
      position: relative;
    }

    /* ===== ESTILOS PARA TARJETAS DE AÑO ===== */
    .year-cards-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
      overflow: auto;
      padding: 70px 20px 20px;
      box-sizing: border-box;
    }

    .year-cards-overlay.visible {
      opacity: 1;
    }

    .year-cards-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 15px;
      background-color: rgba(10, 20, 40, 0.9);
      z-index: 1001;
      text-align: center;
    }

    .year-cards-close {
      position: absolute;
      right: 20px;
      top: 15px;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }

    .year-cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 20px;
      width: 100%;
    }

    .year-planet-card {
      background: linear-gradient(145deg, rgba(20, 40, 80, 0.8) 0%, rgba(10, 20, 40, 0.9) 100%);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid rgba(100, 150, 255, 0.3);
      box-shadow: 0 0 15px rgba(100, 150, 255, 0.2);
    }

    .year-planet-card h3 {
      font-size: 1.1em;
      color: #FFD700;
      margin: 0 0 10px;
      text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    .year-planet-image {
      width: 120px;
      height: 120px;
      position: relative;
      margin: 0 auto 10px;
    }

    .year-planet-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    .year-planet-stat {
      background: rgba(30, 60, 100, 0.5);
      padding: 5px;
      border-radius: 5px;
    }

    .view-details-button {
      background-color: rgba(60, 100, 180, 0.7);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .view-details-button:hover {
      background-color: rgba(80, 120, 220, 0.8);
      transform: translateY(-2px);
    }

    .help-message {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background-color: rgba(0, 0, 0, 0.7);
      color: #adf;
      padding: 10px 20px;
      border-radius: 5px;
      opacity: 0;
      transition: all 0.5s ease;
      pointer-events: none;
    }

    .help-message.visible {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <!-- Fondo espacial -->
  <div id="space-background"></div>
  <div id="overlay"></div>

  <div id="header">
    <h1>Exoplanet Discoveries Timeline</h1>
    <p>Explore planets with high Earth Similarity Index (ESI) discovered over the years</p>
  </div>

  <div class="container">
    <div class="main-content">
      <div id="timeline"></div>
      
      <!-- Tarjeta de planeta dentro de la gráfica -->
      <div id="planet-card">
        <div class="close-button">&times;</div>
        <div class="planet-name">Planet Name</div>
        <div class="planet-image-container">
          <div class="planet-type"></div>
          <canvas id="planet-canvas" width="180" height="180"></canvas>
          <div class="card-shine"></div>
        </div>
        
        <div class="card-tabs">
          <button class="tab-button active" data-tab="basic">Basic</button>
          <button class="tab-button" data-tab="system">System</button>
          <button class="tab-button" data-tab="orbit">Orbit</button>
        </div>
        
        <div class="tab-content" id="basic-tab">
          <div class="planet-stats">
            <div class="stat">
              <span class="stat-name">Discovery year</span>
              <span class="stat-value" id="disc-year">2000</span>
            </div>
            <div class="stat">
              <span class="stat-name">ESI</span>
              <span class="stat-value" id="esi-value">0.00</span>
            </div>
            <div class="stat">
              <span class="stat-name">Radius</span>
              <span class="stat-value" id="radius-value">0.0 R⊕</span>
            </div>
            <div class="stat">
              <span class="stat-name">Mass</span>
              <span class="stat-value" id="mass-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Temperature</span>
              <span class="stat-value" id="temp-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Discovery facility</span>
              <span class="stat-value" id="facility-value">Unknown</span>
            </div>
          </div>
        </div>
        <div class="tab-content hidden" id="system-tab">
          <div class="planet-stats">
            <div class="stat">
              <span class="stat-name">Host star</span>
              <span class="stat-value" id="hostname-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Number of stars</span>
              <span class="stat-value" id="sysnum-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Number of planets</span>
              <span class="stat-value" id="sypnum-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Discovery reference</span>
              <span class="stat-value" id="refname-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Distance</span>
              <span class="stat-value" id="distance-value">Unknown</span>
            </div>
          </div>
        </div>

        <div class="tab-content hidden" id="orbit-tab">
          <div class="planet-stats">
            <div class="stat">
              <span class="stat-name">Orbital period</span>
              <span class="stat-value" id="orbper-value">Unknown</span>
            </div>
            <div class="stat">
              <span class="stat-name">Semi-major exe</span>
              <span class="stat-value" id="orbsmax-value">Unknown</span>
            </div>
          </div>
        </div>
      </div>

      <div class="button-container">
        <button id="prev" class="arrow-button">&larr;</button>
        <button id="next" class="arrow-button">&rarr;</button>
      </div>
    </div>
  </div>

  <script>
    /**
     * VARIABLES GLOBALES
     */
    // Variable para controlar el temporizador de la tarjeta del planeta
    let planetCardTimer = null;
    
    // Variables para datos de planetas
    let allPlanetsData = []; // Datos completos sin filtrar
    let data = []; // Datos cargados desde timeline.json
    let filteredData = []; // Datos filtrados (un planeta por año con el mayor ESI)
    let currentYearIndex = 0; // Índice actual del año mostrado
    let previousYearIndex = 0; // Para rastrear la dirección de navegación
    let yearToIndexMap = {}; // Mapeo de años a índices
    
    // Arrays para almacenar los datos procesados de los planetas
    const planetsData = [];
    
    // Constantes para visualización
    const PLANET_COLOR = 'rgb(51, 255, 246)'; // Color fijo para los planetas
    const HIGHLIGHT_COLOR = 'rgb(253, 243, 39)'; // Color destacado para el planeta actual
    const SIZE_MULTIPLIER = 2.5; // Factor de aumento para el tamaño del planeta destacado
    
    /**
     * INICIALIZACIÓN DE INTERFAZ
     */
    // Crear estrellas para el fondo espacial
    function createStars() {
      const background = document.getElementById('space-background');
      const starCount = 200; // Número de estrellas
    
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
    
        // Tamaño aleatorio (mayormente pequeñas)
        const size = Math.random() * 3;
        star.style.width = size + 'px';
        star.style.height = size + 'px';
    
        // Posición aleatoria
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
    
        // Retraso aleatorio en la animación de parpadeo
        star.style.animationDelay = Math.random() * 4 + 's';
    
        background.appendChild(star);
      }
    }
    
    // Ejecutar la creación de estrellas al cargar
    createStars();
    
    /**
     * CONFIGURACIÓN DE LA GRÁFICA
     */
    // Inicializar la gráfica con ejes estáticos
    const layout = {
      title: {
        text: '',
        font: {
          color: '#FFD700',
          size: 24
        }
      },
      paper_bgcolor: 'rgba(0,0,0,0)',
      plot_bgcolor: 'rgba(0,0,0,0)',
      xaxis: {
        title: {
          text: 'Year of Discovery',
          font: {
            color: '#adf',
            size: 14
          }
        },
        tickfont: {
          color: '#adf'
        },
        showgrid: false,
        tickmode: 'array',
        tickvals: [2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
        range: [2010, 2025]
      },
      yaxis: {
        title: {
          text: 'Earth Similarity Index (ESI)',
          font: {
            color: '#adf',
            size: 14
          }
        },
        tickfont: {
          color: '#adf'
        },
        showgrid: false,
        range: [0, 1]
      },
      hovermode: 'closest',
      dragmode: false
    };
    
    // Configuración para Plotly
    const config = {
      displayModeBar: false,
      responsive: true,
      scrollZoom: false,
      showTips: false,
      modeBarButtonsToRemove: ['select2d', 'lasso2d']
    };
    
    // Crear la gráfica inicial con ejes estáticos
    Plotly.newPlot('timeline', [{
      x: [],
      y: [],
      mode: 'markers',
      type: 'scatter',
      marker: {
        size: [],
        color: PLANET_COLOR,
        showscale: false,
        line: {
          color: 'rgba(100, 150, 255, 0.5)',
          width: 1
        },
        opacity: 0.8
      },
      text: [],
      hoverinfo: 'none'
    }], layout, config);
    
    /**
     * CARGA Y PROCESAMIENTO DE DATOS
     */
    // Cargar los datos desde timeline.json
    fetch('timeline.json')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(jsonData => {
        data = jsonData;
        allPlanetsData = jsonData; // Guardar todos los datos
    
        // Filtrar los datos para obtener el planeta con el mayor ESI por año
        const planetsByYear = {};
        data.forEach(planet => {
          if (!planet.disc_year) return; // Ignorar planetas sin año de descubrimiento
          
          const year = planet.disc_year;
          // Asegurar que ESI sea un número válido
          const esiValue = (typeof planet.ESI === 'number' && !isNaN(planet.ESI)) ? planet.ESI : 0;
          if (!planetsByYear[year] || esiValue > planetsByYear[year].ESI) {
            planetsByYear[year] = { ...planet, ESI: esiValue }; // Almacenar el ESI validado
          }
        });
    
        // Convertir el objeto en una lista ordenada por año
        filteredData = Object.values(planetsByYear).sort((a, b) => a.disc_year - b.disc_year);
    
        // Crear mapeo de año a índice
        filteredData.forEach((planet, index) => {
          yearToIndexMap[planet.disc_year] = index;
        });
    
        // Preprocesar los datos de los planetas
        planetsData.length = 0; // Limpiar datos previos si existen
        for (let i = 0; i < filteredData.length; i++) {
          const planet = filteredData[i];
          planetsData.push({
            x: planet.disc_year,
            y: Math.max(0, planet.ESI), // Usar el ESI validado
            baseSize: (planet.pl_rade || 1) * 10,
            text: `Planet: ${planet.pl_name}<br>Year: ${planet.disc_year}<br>ESI: ${planet.ESI.toFixed(2)}<br>Radius: ${planet.pl_rade || 'N/A'} Earth radius`
          });
        }
    
        // Inicializar la gráfica con el primer planeta
        updateTimeline();
        
        // Mostrar mensaje de ayuda después de 3 segundos
        setTimeout(() => {
          document.getElementById('help-message').classList.add('visible');
          setTimeout(() => {
            document.getElementById('help-message').classList.remove('visible');
          }, 5000);
        }, 3000);
    
        // Agregar evento para detectar clics en los planetas
        const plotDiv = document.getElementById('timeline');
        plotDiv.on('plotly_click', function(eventData) {
          // Si se hizo clic en un punto
          if (eventData.points && eventData.points.length > 0) {
            const point = eventData.points[0];
            const pointIndex = point.pointNumber;
            
            // Si estamos en vista normal y hacemos clic en un planeta
            if (pointIndex >= 0 && pointIndex < filteredData.length && pointIndex <= currentYearIndex) {
              // Mostrar la tarjeta del planeta
              console.log('Showing card for planet:', filteredData[pointIndex].pl_name);
              showPlanetCard(filteredData[pointIndex]);
              
              // Cancelar el temporizador para evitar mostrar otra tarjeta automáticamente
              if (planetCardTimer) {
                clearTimeout(planetCardTimer);
                planetCardTimer = null;
              }
            }
          }
        });
      })
      .catch(error => {
        console.error('Error loading or processing timeline.json:', error);
        // Mostrar mensaje de error al usuario
        const header = document.getElementById('header');
        const errorMsg = document.createElement('p');
        errorMsg.style.color = 'red';
        errorMsg.textContent = 'Error loading planet data. Please check the console for details.';
        header.appendChild(errorMsg);
      });
    
    /**
     * ACTUALIZACIÓN DE LA LÍNEA DE TIEMPO
     */
    // Función para actualizar la línea de tiempo general
    function updateTimeline() {
      // Cancelar cualquier temporizador existente para mostrar la tarjeta
      if (planetCardTimer) {
        clearTimeout(planetCardTimer);
        planetCardTimer = null;
      }
    
      // Cerrar la tarjeta si está abierta
      closePlanetCard();
    
      if (currentYearIndex >= 0 && currentYearIndex < filteredData.length) {
        const planet = filteredData[currentYearIndex];
    
        // Determinar dirección de navegación
        const isForward = currentYearIndex >= previousYearIndex;
        previousYearIndex = currentYearIndex;
    
        // Crear arrays para mostrar solo hasta el índice actual
        const visibleX = [];
        const visibleY = [];
        const visibleSizes = [];
        const visibleColors = [];
        const visibleTexts = [];
    
        // Acumular solo hasta el índice actual
        for (let i = 0; i <= currentYearIndex; i++) {
          if (planetsData[i]) { // Verificar si existen datos para este índice
            visibleX.push(planetsData[i].x);
            visibleY.push(planetsData[i].y);
    
            // Si es el planeta actual, hacerlo más grande y destacarlo
            if (i === currentYearIndex) {
              visibleSizes.push(planetsData[i].baseSize * SIZE_MULTIPLIER);
              visibleColors.push(HIGHLIGHT_COLOR);
            } else {
              visibleSizes.push(planetsData[i].baseSize);
              visibleColors.push(PLANET_COLOR);
            }
            visibleTexts.push(planetsData[i].text);
          } else {
            console.warn(`Missing planet data for index ${i}`);
          }
        }
    
        // Actualizar la gráfica con los planetas visibles
        Plotly.react('timeline', [{
          x: visibleX,
          y: visibleY,
          mode: 'markers',
          type: 'scatter',
          marker: {
            size: visibleSizes,
            color: visibleColors,
            showscale: false,
            line: {
              color: 'rgba(100, 150, 255, 0.5)',
              width: 1
            },
            opacity: 0.8,
            symbol: 'circle' // Asegurar que los puntos son círculos
          },
          text: visibleTexts,
          hoverinfo: 'none'  // No mostrar texto en hover
        }], layout, {
          transition: {
            duration: 1200,
            easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)'
          },
          frame: {
            duration: 1200,
            redraw: false
          }
        }).then(() => {
          // Asegurarse de que el cursor esté configurado después de la actualización del gráfico
          setPointCursor();
        });
    
        // Configurar temporizador para mostrar la tarjeta del planeta actual después de 1 segundo
        if (!document.getElementById('planet-card').classList.contains('visible')) {
          planetCardTimer = setTimeout(() => {
            console.log('Automatic timer showing card for:', planet.pl_name);
            showPlanetCard(planet);
            planetCardTimer = null; // Limpiar referencia del temporizador después de la ejecución
          }, 1000);
        }
    
      } else {
        console.error('Invalid year index:', currentYearIndex);
      }
    }
    
    /**
     * FUNCIONES PARA INTERACCIÓN DE PLANETAS
     */
    // Configurar cursor y estilos para los puntos del gráfico
    function setPointCursor() {
      const points = document.querySelectorAll('#timeline .scatterlayer .trace .points path');
      points.forEach(point => {
        // Establecer cursor pointer y preparar para efectos hover
        point.style.cursor = 'pointer';
        
        // Asegurar que las transiciones estén aplicadas
        if (!point.style.transition) {
          point.style.transition = 'transform 0.3s ease-out, opacity 0.2s ease';
        }
      });
      
      // También establecer cursor predeterminado para el fondo del gráfico
      const plotBg = document.querySelector('#timeline .plot-container .svg-container');
      if (plotBg) {
        plotBg.style.cursor = 'default';
      }
    }
    
    // Función para mostrar y animar la tarjeta del planeta
    function showPlanetCard(planet) {
      if (!planet) {
        console.error("showPlanetCard called with invalid planet data:", planet);
        return;
      }
      const planetCard = document.getElementById('planet-card');
      const overlay = document.getElementById('overlay');
    
      // Actualizar contenido básico
      planetCard.querySelector('.planet-name').textContent = planet.pl_name || 'Unknown Planet';
      
      // Información básica (pestaña 1)
      document.getElementById('disc-year').textContent = planet.disc_year || 'Unknown';
      
      // ESI (valor calculado)
      const esiValue = (typeof planet.ESI === 'number' && !isNaN(planet.ESI)) ? planet.ESI.toFixed(2) : 'N/A';
      document.getElementById('esi-value').textContent = esiValue;
      
      // Radio
      document.getElementById('radius-value').innerHTML = planet.pl_rade 
      ? `${planet.pl_rade.toFixed(2)} Times Earth` 
      : 'Unknown';
        
      // Masa
      document.getElementById('mass-value').innerHTML = planet.pl_bmasse 
      ? `${planet.pl_bmasse.toFixed(2)} Times Earth` 
      : 'Unknown';
      
      // Temperatura
      document.getElementById('temp-value').textContent = planet.pl_eqt ? `${planet.pl_eqt} K` : 'Unknown';
      
      // Instalación de descubrimiento
      document.getElementById('facility-value').textContent = planet.disc_facility || 'Unknown';
    
      // Información del sistema (pestaña 2)
      document.getElementById('hostname-value').textContent = planet.hostname || 'Unknown';
      document.getElementById('sysnum-value').textContent = planet.sy_snum || 'Unknown';
      document.getElementById('sypnum-value').textContent = planet.sy_pnum || 'Unknown';
      if (planet.pl_refname) {
        const hrefMatch = planet.pl_refname.match(/href=([^ >]+)/);
        if (hrefMatch) {
          const url = hrefMatch[1];
          document.getElementById('refname-value').innerHTML = `<a href="${url}" target="_blank">Reference</a>`;
        } else {
          document.getElementById('refname-value').textContent = 'Unknown';
        }
      } else {
        document.getElementById('refname-value').textContent = 'Unknown';
      }
      
      document.getElementById('distance-value').textContent = planet.sy_dist ? `${planet.sy_dist.toFixed(1)} pc` : 'Unknown';
    
      // Información orbital (pestaña 3)
      document.getElementById('orbper-value').textContent = planet.pl_orbper ? `${planet.pl_orbper.toFixed(1)} days` : 'Unknown';
      document.getElementById('orbsmax-value').textContent = planet.pl_orbsmax ? `${planet.pl_orbsmax.toFixed(3)} AU` : 'Unknown';
    
      // Determinar el tipo de planeta según el ESI
      const planetType = document.querySelector('.planet-type');
      const esiNum = (typeof planet.ESI === 'number' && !isNaN(planet.ESI)) ? planet.ESI : -1; // -1 si no es un número
    
      if (esiNum >= 0.8) {
        planetType.style.backgroundColor = "rgba(0, 255, 0, 0.8)";
      } else if (esiNum >= 0.6) {
        planetType.style.backgroundColor = "rgba(255, 215, 0, 0.8)";
      } else if (esiNum >= 0) { // Solo mostrar si ESI es conocido y >= 0
        planetType.style.backgroundColor = "rgba(255, 165, 0, 0.8)";
      } else {
        planetType.textContent = "Unknown Type";
        planetType.style.backgroundColor = "rgba(128, 128, 128, 0.8)"; // Gris para desconocido
      }
    
      // Generar imagen del planeta
      generatePlanetImage(planet);
    
      // Mostrar la tarjeta y el overlay con animación
      overlay.classList.add('active');
      planetCard.classList.add('visible');
    }
    
    // Función para cerrar la tarjeta del planeta
    function closePlanetCard() {
      const planetCard = document.getElementById('planet-card');
      const overlay = document.getElementById('overlay');
    
      planetCard.classList.remove('visible');
      overlay.classList.remove('active');
    }
    
    /**
     * FUNCIONES PARA GENERACIÓN DE IMÁGENES DE PLANETAS
     */
    // Función para generar una imagen de planeta basada en sus características
    function generatePlanetImage(planet) {
      const canvas = document.getElementById('planet-canvas');
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
    
      // Limpiar el canvas
      ctx.clearRect(0, 0, width, height);
    
      // Calcular el color base del planeta basado en el ESI
      let r, g, b;
      const esiNum = (typeof planet.ESI === 'number' && !isNaN(planet.ESI)) ? planet.ESI : 0.5;
    
      if (esiNum >= 0.8) {
        // Muy similar a la Tierra
        r = 30 + Math.random() * 50;
        g = 100 + Math.random() * 80;
        b = 180 + Math.random() * 60;
      } else if (esiNum >= 0.6) {
        // Bastante similar
        r = 70 + Math.random() * 60;
        g = 140 + Math.random() * 60;
        b = 100 + Math.random() * 80;
      } else {
        // Menos similar o desconocido
        r = 140 + Math.random() * 100;
        g = 80 + Math.random() * 80;
        b = 40 + Math.random() * 50;
      }
    
      // Radio del planeta
      const radius = width / 2 - 2;
    
      // Dibujar el planeta base (círculo)
      const gradient = ctx.createRadialGradient(
        width / 2, height / 2, 0,
        width / 2, height / 2, radius
      );
    
      // Centro más brillante, borde más oscuro
      gradient.addColorStop(0, `rgba(${r+30}, ${g+30}, ${b+30}, 1)`);
      gradient.addColorStop(0.5, `rgba(${r}, ${g}, ${b}, 1)`);
      gradient.addColorStop(0.9, `rgba(${r*0.7}, ${g*0.7}, ${b*0.7}, 1)`);
      gradient.addColorStop(1, `rgba(${r*0.5}, ${g*0.5}, ${b*0.5}, 1)`);
    
      ctx.beginPath();
      ctx.arc(width / 2, height / 2, radius, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();
    
      // Agregar características basadas en el planeta
      if (esiNum >= 0.7) {
        ctx.globalCompositeOperation = "overlay";
    
        // Dibujar "continentes" con formas orgánicas
        const numberOfContinents = 3 + Math.floor(Math.random() * 5);
    
        ctx.fillStyle = `rgba(${r*0.7}, ${g*1.3}, ${b*0.7}, 0.5)`;
    
        for (let i = 0; i < numberOfContinents; i++) {
          // Punto central del continente
          const angle = Math.random() * Math.PI * 2;
          const distFromCenter = radius * (0.2 + Math.random() * 0.7);
          const x = width/2 + Math.cos(angle) * distFromCenter;
          const y = height/2 + Math.sin(angle) * distFromCenter;
    
          // Tamaño del continente
          const continentSize = radius * (0.2 + Math.random() * 0.3);
    
          // Dibujar forma irregular
          ctx.beginPath();
          ctx.moveTo(x, y);
    
          for (let j = 0; j < 8; j++) {
            const ang = (j / 8) * Math.PI * 2;
            const rad = continentSize * (0.7 + Math.random() * 0.6);
            const xPoint = x + Math.cos(ang) * rad;
            const yPoint = y + Math.sin(ang) * rad;
            ctx.lineTo(xPoint, yPoint);
          }
    
          ctx.closePath();
          ctx.fill();
        }
      }
      else { // Para planetas menos similares a la Tierra, dibujar bandas
        ctx.globalCompositeOperation = "overlay";
    
        // Número de bandas
        const numberOfBands = 3 + Math.floor(Math.random() * 4);
    
        for (let i = 0; i < numberOfBands; i++) {
          // Ancho aleatorio para cada banda
          const bandWidth = radius * (0.1 + Math.random() * 0.2);
    
          // Color aleatorio para la banda
          const bandR = Math.min(255, r * (0.8 + Math.random() * 0.6));
          const bandG = Math.min(255, g * (0.8 + Math.random() * 0.6));
          const bandB = Math.min(255, b * (0.8 + Math.random() * 0.6));
    
          ctx.fillStyle = `rgba(${bandR}, ${bandG}, ${bandB}, 0.5)`;
    
          ctx.beginPath();
          ctx.ellipse(width/2, height/2, radius, bandWidth, Math.random() * Math.PI, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    
      // Restaurar modo de composición
      ctx.globalCompositeOperation = "source-over";
    
      // Agregar brillo/atmósfera
      const glowGradient = ctx.createRadialGradient(
        width / 2, height / 2, radius * 0.8,
        width / 2, height / 2, radius + 10
      );
      glowGradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, 0)`);
      glowGradient.addColorStop(0.5, `rgba(${r}, ${g}, ${b}, 0.03)`);
      glowGradient.addColorStop(0.8, `rgba(${r}, ${g}, ${b}, 0.05)`);
      glowGradient.addColorStop(1, `rgba(${r}, ${g}, ${b}, 0)`);
    
      ctx.beginPath();
      ctx.arc(width / 2, height / 2, radius + 10, 0, Math.PI * 2);
      ctx.fillStyle = glowGradient;
      ctx.fill();
    
      // Agregar iluminación en un lado
      const highlightGradient = ctx.createRadialGradient(
        width / 2 - radius * 0.5, height / 2 - radius * 0.5, 0,
        width / 2, height / 2, radius
      );
      highlightGradient.addColorStop(0, `rgba(255, 255, 255, 0.2)`);
      highlightGradient.addColorStop(0.5, `rgba(255, 255, 255, 0.05)`);
      highlightGradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
    
      ctx.globalCompositeOperation = "overlay"; // Usar overlay para un resaltado sutil
      ctx.beginPath();
      ctx.arc(width / 2, height / 2, radius, 0, Math.PI * 2);
      ctx.fillStyle = highlightGradient;
      ctx.fill();
    
      // Restaurar modo de composición por defecto
      ctx.globalCompositeOperation = "source-over";
    }
    
    /**
     * GESTIÓN DE TARJETAS DE PLANETAS POR AÑO
     */
    // Variable para contenedor de tarjetas de año
    let yearCardsContainer = null;
    
    // Función para detectar clicks en los años del eje X
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        setupYearClickEvents();
      }, 1000); // Dar tiempo a que Plotly renderice completamente
    });
    
    // Configurar eventos de clic en las etiquetas de años
    function setupYearClickEvents() {
      const xAxisLabels = document.querySelectorAll('.xtick text');
      
      xAxisLabels.forEach(label => {
        label.style.cursor = 'pointer';
        label.style.fontWeight = 'bold';
        
        // Eliminar cualquier evento existente para prevenir duplicados
        label.removeEventListener('click', onYearLabelClick);
        
        // Añadir el evento de clic
        label.addEventListener('click', onYearLabelClick);
      });
    }
    
    // Función que maneja el clic en una etiqueta de año
    function onYearLabelClick(event) {
      const year = parseInt(event.target.textContent);
      if (!isNaN(year)) {
        console.log(`Clicked on year: ${year}`);
        showPlanetsForYear(year);
        // Prevenir la propagación para evitar otros eventos
        event.stopPropagation();
      }
    }
    
    // Función para mostrar los planetas de un año específico
    function showPlanetsForYear(year) {
      // Limpiar cualquier visualización anterior
      if (yearCardsContainer) {
        yearCardsContainer.remove();
      }
      
      // Filtrar planetas del año seleccionado
      const yearPlanets = allPlanetsData.filter(planet => planet.disc_year === year);
      
      if (yearPlanets.length === 0) {
        console.warn(`No se encontraron planetas para el año ${year}`);
        return;
      }
      
      console.log(`Se encontraron ${yearPlanets.length} planetas en el año ${year}`);
      
      // Crear contenedor para las tarjetas
      yearCardsContainer = document.createElement('div');
      yearCardsContainer.className = 'year-cards-overlay';
      yearCardsContainer.innerHTML = `
        <div class="year-cards-header">
          <h2>Planetas descubiertos en ${year}</h2>
          <button class="year-cards-close">&times;</button>
        </div>
        <div class="year-cards-container"></div>
      `;
      document.body.appendChild(yearCardsContainer);
      
      const cardsContainer = yearCardsContainer.querySelector('.year-cards-container');
      
      // Crear tarjetas para cada planeta
      yearPlanets.forEach(planet => {
        const card = createSimplePlanetCard(planet);
        cardsContainer.appendChild(card);
      });
      
      // Configurar evento para cerrar la vista
      yearCardsContainer.querySelector('.year-cards-close').addEventListener('click', () => {
        yearCardsContainer.remove();
        yearCardsContainer = null;
      });
      
      // Hacer visible con una pequeña animación
      setTimeout(() => {
        yearCardsContainer.classList.add('visible');
        // Hacer que las tarjetas aparezcan con efecto secuencial
        const cards = cardsContainer.querySelectorAll('.year-planet-card');
        cards.forEach((card, index) => {
          setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, index * 50);
        });
      }, 10);
    }
    
    // Función para crear una tarjeta simple de planeta
    function createSimplePlanetCard(planet) {
      const card = document.createElement('div');
      card.className = 'year-planet-card';
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      
      // Determinar tipo de planeta según ESI
      const esiNum = (typeof planet.ESI === 'number' && !isNaN(planet.ESI)) ? planet.ESI : 0;
      let planetTypeText = "Desconocido";
      let typeColor = "rgba(128, 128, 128, 0.8)";
      
      if (esiNum >= 0.8) {
        planetTypeText = "Muy similar a la Tierra";
        typeColor = "rgba(0, 255, 0, 0.8)";
      } else if (esiNum >= 0.6) {
        planetTypeText = "Similar a la Tierra";
        typeColor = "rgba(255, 215, 0, 0.8)";
      } else if (esiNum > 0) {
        planetTypeText = "Potencialmente habitable";
        typeColor = "rgba(255, 165, 0, 0.8)";
      }
      
      // Contenido de la tarjeta
      card.innerHTML = `
        <h3>${planet.pl_name || 'Planeta desconocido'}</h3>
        <div class="year-planet-image">
          <canvas width="120" height="120"></canvas>
          <div class="planet-type" style="background-color: ${typeColor}">${planetTypeText}</div>
        </div>
        <div class="year-planet-info">
          <div class="year-planet-stat">
            <span class="stat-name">ESI</span>
            <span class="stat-value">${typeof planet.ESI === 'number' ? planet.ESI.toFixed(2) : 'N/A'}</span>
          </div>
          <div class="year-planet-stat">
            <span class="stat-name">Radio</span>
            <span class="stat-value">${planet.pl_rade ? planet.pl_rade.toFixed(2) + ' R⊕' : 'N/A'}</span>
          </div>
        </div>
        <button class="view-details-button">Ver detalles</button>
      `;
      
      // Generar imagen del planeta
      const canvas = card.querySelector('canvas');
      generateYearPlanetImage(planet, canvas);
      
      // Añadir evento para ver detalles completos
      card.querySelector('.view-details-button').addEventListener('click', () => {
        yearCardsContainer.remove();
        yearCardsContainer = null;
        showPlanetCard(planet);
      });
      
      return card;
    }
    
    // Función simplificada para generar imagen del planeta en tarjetas de año
    function generateYearPlanetImage(planet, canvas) {
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      
      ctx.clearRect(0, 0, width, height);
      
      // Color basado en ESI
      let r, g, b;
      const esiNum = (typeof planet.ESI === 'number' && !isNaN(planet.ESI)) ? planet.ESI : 0.5;
      
      if (esiNum >= 0.8) {
        r = 30 + Math.random() * 50;
        g = 100 + Math.random() * 80;
        b = 180 + Math.random() * 60;
      } else if (esiNum >= 0.6) {
        r = 70 + Math.random() * 60;
        g = 140 + Math.random() * 60;
        b = 100 + Math.random() * 80;
      } else {
        r = 140 + Math.random() * 100;
        g = 80 + Math.random() * 80;
        b = 40 + Math.random() * 50;
      }
      
      const radius = width / 2 - 2;
      
      // Dibujar planeta con gradiente simple
      const gradient = ctx.createRadialGradient(
        width/2, height/2, 0,
        width/2, height/2, radius
      );
      
      gradient.addColorStop(0, `rgba(${r+30}, ${g+30}, ${b+30}, 1)`);
      gradient.addColorStop(0.5, `rgba(${r}, ${g}, ${b}, 1)`);
      gradient.addColorStop(1, `rgba(${r*0.7}, ${g*0.7}, ${b*0.7}, 1)`);
      
      ctx.beginPath();
      ctx.arc(width/2, height/2, radius, 0, Math.PI * 2);
      ctx.fillStyle = gradient;
      ctx.fill();
    }
    
    /**
     * EVENTOS Y ANIMACIONES DE INTERFAZ
     */
    // Manejar las pestañas de la tarjeta del planeta
    document.addEventListener('DOMContentLoaded', function() {
      const tabButtons = document.querySelectorAll('.tab-button');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Desactivar todos los botones y ocultar contenido
          tabButtons.forEach(btn => btn.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
          
          // Activar el botón seleccionado y mostrar su contenido
          button.classList.add('active');
          const tabId = button.getAttribute('data-tab');
          document.getElementById(`${tabId}-tab`).classList.remove('hidden');
        });
      });
    });
    
    // Configurar el evento de cierre de la tarjeta
    document.querySelector('.close-button').addEventListener('click', closePlanetCard);
    document.getElementById('overlay').addEventListener('click', closePlanetCard);
    
    // Función para manejar el botón "Previous"
    document.getElementById('prev').addEventListener('click', () => {
      if (currentYearIndex > 0) {
        currentYearIndex--;
        updateTimeline();
        animateButton('prev');
      } else {
        shakeButton('prev');
      }
    });
    
    // Función para manejar el botón "Next"
    document.getElementById('next').addEventListener('click', () => {
      if (currentYearIndex < filteredData.length - 1) {
        currentYearIndex++;
        updateTimeline();
        animateButton('next');
      } else {
        shakeButton('next');
      }
    });
    
    // Función para animar un botón cuando se hace clic
    function animateButton(buttonId) {
      const button = document.getElementById(buttonId);
      button.style.transform = 'scale(1.2)';
      button.style.boxShadow = '0 0 25px rgba(100, 150, 255, 0.8)';
    
      setTimeout(() => {
        button.style.transform = 'scale(1)';
        button.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.5), 0 0 15px rgba(100, 150, 255, 0.3)';
      }, 200);
    }
    
    // Función para agitar un botón cuando se llega al límite
    function shakeButton(buttonId) {
      const button = document.getElementById(buttonId);
      button.style.animation = 'shake 0.5s';
    
      setTimeout(() => {
        button.style.animation = '';
      }, 500);
    }
    
    // Configuración inicial al cargar la página
    window.addEventListener('load', () => {
      setPointCursor(); // Configurar cursor inicial
    
      // Observar cambios en el DOM para mantener el cursor adecuado
      const observer = new MutationObserver((mutationsList) => {
        for(const mutation of mutationsList) {
          if (mutation.target.classList.contains('scatterlayer') || mutation.addedNodes.length > 0) {
            setPointCursor();
            break;
          }
        }
      });
    
      const timelinePlot = document.getElementById('timeline');
      if (timelinePlot) {
        observer.observe(timelinePlot, { childList: true, subtree: true });
      }
    });
    
    // Observar cambios en el gráfico para mantener los eventos
    const originalUpdateTimeline = updateTimeline;
    updateTimeline = function() {
      originalUpdateTimeline();
      setTimeout(setupYearClickEvents, 200);
    };
  </script>
</body>
</html>